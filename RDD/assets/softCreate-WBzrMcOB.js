import{d as $,s as N,r as R,w as W,b as v,c as g,e as c,f as y,g as S,h as t,i as a,j as r,k as d,F as _,m as F,l as M,n as C,_ as E}from"./index-C8i1NBWL.js";import{u as H,b as Q,c as J,S as K,R as X,d as Y,p as Z,r as O,U as ee,e as le}from"./userStore-u9qmRA6a.js";const ae={class:"content"},oe={class:"create-form"},re=t("p",{class:"title"},"軟體申請單",-1),ue={class:"area"},te={class:"area-row"},ne={class:"area-row"},se={class:"area-row"},de={class:"area-row"},pe={class:"area-row"},me={class:"area-row"},ie=t("hr",{style:{border:"1px dashed var(--gray-border)"}},null,-1),ve={class:"area-row"},ge={class:"area-row"},ce={class:"area-row"},fe={class:"area-row"},_e={class:"area-row"},Fe={class:"area-row"},Ve={class:"area-row"},be={class:"area-row"},ye={key:0,class:"area-row"},De=t("p",{class:"version"},"QP-038-07-H",-1),Oe=$({__name:"softCreate",setup(Ne){const P=C(()=>E(()=>import("./LoadingGIF-EHAp8heU.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)),U=C(()=>E(()=>import("./CreateTopBtn-evltKm_Z.js"),__vite__mapDeps([4,5,2,3,6,1,7]),import.meta.url)),x=C(()=>E(()=>import("./FileCom-k_RcCnuG.js"),__vite__mapDeps([8,2,3,6]),import.meta.url)),T=H(),{userStoreData:b}=N(T),B=Q(),{baseStoreData:f}=N(B);f.value.file=[];const D=J();N(D);const h=R(null),e=R({isLoading:!1,runningCount:0,ruleForm:{RDPADept:"",RDPAEmpid:"",personOptions:[],applyDept:"",applyDeptOptions:[{value:"研發一課",label:"研發一課"},{value:"研發二課",label:"研發二課"},{value:"研發三課",label:"研發三課"}],applyReason:"",applyReasonOptions:[{value:"制定",label:"制定"},{value:"修定",label:"修定"},{value:"廢止",label:"廢止"}],programV:"",SVNV:"",programName:"",Model:"",IC:"",applyArea:[],applyAreaOptions:[{value:"台灣",label:"台灣"},{value:"蘇州",label:"蘇州"}],applyType:[],applyTypeOptions:[{value:"產線",label:"產線"},{value:"雲端",label:"雲端"}],bomElno:"",modelNO:"",suzobomElno:"",suzoModelNO:"",reviseB:"",reviseA:"",reviseDoc:"",choiceDoc:[]},rules:{RDPAEmpid:[{required:!0,message:"請選擇簽核時的研發PA",trigger:"change"}],applyDept:[{required:!0,message:"請選擇申請單位",trigger:"change"}],applyReason:[{required:!0,message:"請選擇申請原因",trigger:"change"}],programV:[{required:!0,message:"請填寫程式版號",trigger:"change"}],SVNV:[{required:!0,message:"請填寫SVN",trigger:"change"}],programName:[{required:!0,message:"請填寫程式名稱",trigger:"change"}],Model:[{required:!0,message:"請填寫適用機種",trigger:"change"}],IC:[{required:!0,message:"請填寫IC",trigger:"change"}],applyArea:[{type:"array",required:!0,message:"請選擇申請地區",trigger:"change"}],applyType:[{type:"array",required:!0,message:"請選擇申請類別",trigger:"change"}],reviseB:[{required:!0,message:"請填寫修改前內容",trigger:"change"}],reviseA:[{required:!0,message:"請填寫修改後內容",trigger:"change"}],reviseDoc:[{required:!0,message:"請選擇相關文件是否修改",trigger:"change"}],choiceDoc:[{type:"array",required:!0,message:"請選擇申請類別",trigger:"change"}]},formId:""});W(()=>e.value.runningCount,u=>{console.log("watch",u),e.value.isLoading=!0,e.value.runningCount===0&&(e.value.isLoading=!1)});async function k(u){e.value.ruleForm.RDPAEmpid="",e.value.ruleForm.personOptions=f.value.allPersons.filter(o=>o.DeptId===u)}function z(){h.value.validate(u=>{u?(console.log("驗證ok",u),q()):console.log("驗證error",u)})}async function q(){K.fire({title:"表單送簽",text:"表單送出後，如要更改或作廢請洽MIS",showCancelButton:!0,confirmButtonColor:"#333",cancelButtonColor:"#d33",confirmButtonText:"確認",cancelButtonText:"取消"}).then(u=>{u.value&&L()})}async function L(){e.value.runningCount++,await X({RDDId:"",Status:"1",ComId:b.value.ResourcesId,DeptId:b.value.DeptId,applyDept:e.value.ruleForm.applyDept,applyReason:e.value.ruleForm.applyReason,programV:e.value.ruleForm.programV,SVNV:e.value.ruleForm.SVNV,programName:e.value.ruleForm.programName,Model:e.value.ruleForm.Model,IC:e.value.ruleForm.IC,applyArea:e.value.ruleForm.applyArea.join(","),applyType:e.value.ruleForm.applyType.join(","),bomElno:e.value.ruleForm.bomElno,modelNO:e.value.ruleForm.modelNO,suzobomElno:e.value.ruleForm.suzobomElno,suzoModelNO:e.value.ruleForm.suzoModelNO,reviseB:e.value.ruleForm.reviseB,reviseA:e.value.ruleForm.reviseA,reviseDoc:e.value.ruleForm.reviseDoc,choiceDoc:e.value.ruleForm.choiceDoc.join(","),Createid:b.value.EmpId,Type:"0"}).then(async u=>{if(console.log("回應表單號碼",u.data),e.value.formId=u.data,f.value.file.length>0&&await I()===!1)throw"檔案上傳錯誤";return e.value.formId}).then(async u=>{const o={formId:u,formName:"軟體申請單"};await Y({SIGNER:e.value.ruleForm.RDPAEmpid,FORMNO:e.value.formId,SIGNORDER:"1",STEPNAME:"研發PA",SignGroup:"簽核"}),await D.fetchNextSigner(o),console.log("發信前"),await D.sendMail(o),console.log("結束")}).then(()=>{console.log("成功"),e.value.runningCount--,Z("RDD")}).catch(u=>{console.log(u),e.value.runningCount--,O("建立表單發生錯誤！")})}async function I(){if(f.value.file.length===0)return!0;const u=f.value.file.shift();console.log("uploadDFileCurrent",u);let o=new FormData;return o.append("file",u),o.append("FileName",u.name),o.append("FormId",e.value.formId),o.append("EmpId",b.value.EmpId),o.append("WebName","RDDForm"),e.value.runningCount++,await ee(o).then(m=>(console.log("附件上傳後端",m),e.value.runningCount--,!0)).catch(m=>(console.log(m),e.value.runningCount--,O("附件上傳後端發生錯誤"),!1))===!1?!1:new Promise(m=>{setTimeout(()=>{m(I())},1e3)})}async function w(u,o){await le(u).then(async p=>{o==="bomElno"?e.value.ruleForm.modelNO=p.data[0].el_taxno:e.value.ruleForm.suzoModelNO=p.data[0].el_taxno,console.log("ModelNO",e.value.ruleForm.modelNO),console.log("suzoModelNO",e.value.ruleForm.suzoModelNO)}).catch(p=>{console.log(p),O("取ModelNO發生錯誤")})}return(u,o)=>{const p=v("el-option"),m=v("el-select"),n=v("el-form-item"),s=v("el-col"),i=v("el-input"),A=v("el-radio"),V=v("el-checkbox"),G=v("el-checkbox-group"),j=v("el-form");return d(),g("div",ae,[e.value.isLoading===!0?(d(),c(y(P),{key:0})):S("",!0),t("div",oe,[re,a(y(U),{formId:e.value.formId,onCallShowBox:z},null,8,["formId"]),t("div",ue,[a(j,{model:e.value.ruleForm,rules:e.value.rules,ref_key:"ruleFormDOM",ref:h,"label-width":"170px",class:"demo-ruleForm"},{default:r(()=>[t("div",te,[a(s,{span:24},{default:r(()=>[a(n,{label:"請選擇研發PA：",prop:"RDPAEmpid"},{default:r(()=>[a(m,{modelValue:e.value.ruleForm.RDPADept,"onUpdate:modelValue":o[0]||(o[0]=l=>e.value.ruleForm.RDPADept=l),onChange:o[1]||(o[1]=l=>k(e.value.ruleForm.RDPADept)),placeholder:"部門","no-data-text":"無數據"},{default:r(()=>[(d(!0),g(_,null,F(y(f).branchs,l=>(d(),c(p,{key:l.DeptId,label:l.DeptName,value:l.DeptId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(m,{modelValue:e.value.ruleForm.RDPAEmpid,"onUpdate:modelValue":o[2]||(o[2]=l=>e.value.ruleForm.RDPAEmpid=l),class:"ml-1",placeholder:"人員"},{default:r(()=>[(d(!0),g(_,null,F(e.value.ruleForm.personOptions,l=>(d(),c(p,{key:l.EmpId,label:l.EmpName,value:l.EmpId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),t("div",ne,[a(s,{span:12},{default:r(()=>[a(n,{label:"申請單位：",prop:"applyDept"},{default:r(()=>[a(m,{modelValue:e.value.ruleForm.applyDept,"onUpdate:modelValue":o[3]||(o[3]=l=>e.value.ruleForm.applyDept=l),placeholder:"請選擇","popper-append-to-body":!1},{default:r(()=>[(d(!0),g(_,null,F(e.value.ruleForm.applyDeptOptions,l=>(d(),c(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(s,{span:12},{default:r(()=>[a(n,{label:"申請原因：",prop:"applyReason"},{default:r(()=>[a(m,{modelValue:e.value.ruleForm.applyReason,"onUpdate:modelValue":o[4]||(o[4]=l=>e.value.ruleForm.applyReason=l),placeholder:"請選擇"},{default:r(()=>[(d(!0),g(_,null,F(e.value.ruleForm.applyReasonOptions,l=>(d(),c(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),t("div",se,[a(s,{span:12},{default:r(()=>[a(n,{label:"程式版號：",prop:"programV"},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.programV,"onUpdate:modelValue":o[5]||(o[5]=l=>e.value.ruleForm.programV=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{span:12},{default:r(()=>[a(n,{label:"SVN版號：",prop:"SVNV"},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.SVNV,"onUpdate:modelValue":o[6]||(o[6]=l=>e.value.ruleForm.SVNV=l)},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",de,[a(s,{span:24},{default:r(()=>[a(n,{label:"程式名稱：",prop:"programName"},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.programName,"onUpdate:modelValue":o[7]||(o[7]=l=>e.value.ruleForm.programName=l)},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",pe,[a(s,{span:24},{default:r(()=>[a(n,{label:"適用機種：",prop:"Model"},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.Model,"onUpdate:modelValue":o[8]||(o[8]=l=>e.value.ruleForm.Model=l)},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",me,[a(s,{span:24},{default:r(()=>[a(n,{label:"IC：",prop:"IC"},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.IC,"onUpdate:modelValue":o[9]||(o[9]=l=>e.value.ruleForm.IC=l)},null,8,["modelValue"])]),_:1})]),_:1})]),ie,t("div",ve,[a(s,{span:12},{default:r(()=>[a(n,{label:"申請地區：",prop:"applyArea"},{default:r(()=>[a(m,{modelValue:e.value.ruleForm.applyArea,"onUpdate:modelValue":o[10]||(o[10]=l=>e.value.ruleForm.applyArea=l),multiple:"",placeholder:"可複選","popper-append-to-body":!1},{default:r(()=>[(d(!0),g(_,null,F(e.value.ruleForm.applyAreaOptions,l=>(d(),c(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(s,{span:12},{default:r(()=>[a(n,{label:"申請類別：",prop:"applyType"},{default:r(()=>[a(m,{modelValue:e.value.ruleForm.applyType,"onUpdate:modelValue":o[11]||(o[11]=l=>e.value.ruleForm.applyType=l),multiple:"",placeholder:"可複選"},{default:r(()=>[(d(!0),g(_,null,F(e.value.ruleForm.applyTypeOptions,l=>(d(),c(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),t("div",ge,[a(s,{span:24},{default:r(()=>[a(n,{label:"台灣四階料號："},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.bomElno,"onUpdate:modelValue":o[12]||(o[12]=l=>e.value.ruleForm.bomElno=l),onChange:o[13]||(o[13]=l=>w(e.value.ruleForm.bomElno,"bomElno"))},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",ce,[a(s,{span:24},{default:r(()=>[a(n,{label:"台灣Model NO："},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.modelNO,"onUpdate:modelValue":o[14]||(o[14]=l=>e.value.ruleForm.modelNO=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",fe,[a(s,{span:24},{default:r(()=>[a(n,{label:"蘇州四階料號："},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.suzobomElno,"onUpdate:modelValue":o[15]||(o[15]=l=>e.value.ruleForm.suzobomElno=l),onChange:o[16]||(o[16]=l=>w(e.value.ruleForm.suzobomElno,"suzobomElno"))},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",_e,[a(s,{span:24},{default:r(()=>[a(n,{label:"蘇州Model NO："},{default:r(()=>[a(i,{modelValue:e.value.ruleForm.suzoModelNO,"onUpdate:modelValue":o[17]||(o[17]=l=>e.value.ruleForm.suzoModelNO=l),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",Fe,[a(s,{span:24},{default:r(()=>[a(n,{label:"修改前內容：",prop:"reviseB"},{default:r(()=>[a(i,{type:"textarea",autosize:{minRows:1},modelValue:e.value.ruleForm.reviseB,"onUpdate:modelValue":o[18]||(o[18]=l=>e.value.ruleForm.reviseB=l)},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",Ve,[a(s,{span:24},{default:r(()=>[a(n,{label:"修改後內容：",prop:"reviseA"},{default:r(()=>[a(i,{type:"textarea",autosize:{minRows:1},modelValue:e.value.ruleForm.reviseA,"onUpdate:modelValue":o[19]||(o[19]=l=>e.value.ruleForm.reviseA=l)},null,8,["modelValue"])]),_:1})]),_:1})]),t("div",be,[a(s,{span:24},{default:r(()=>[a(n,{label:"相關文件是否修改：",prop:"reviseDoc"},{default:r(()=>[a(A,{modelValue:e.value.ruleForm.reviseDoc,"onUpdate:modelValue":o[20]||(o[20]=l=>e.value.ruleForm.reviseDoc=l),label:"是"},{default:r(()=>[M("是")]),_:1},8,["modelValue"]),a(A,{modelValue:e.value.ruleForm.reviseDoc,"onUpdate:modelValue":o[21]||(o[21]=l=>e.value.ruleForm.reviseDoc=l),label:"否"},{default:r(()=>[M("否")]),_:1},8,["modelValue"])]),_:1})]),_:1})]),e.value.ruleForm.reviseDoc==="是"?(d(),g("div",ye,[a(s,{span:24},{default:r(()=>[a(n,{label:"選擇修改文件：",prop:"choiceDoc"},{default:r(()=>[a(G,{modelValue:e.value.ruleForm.choiceDoc,"onUpdate:modelValue":o[22]||(o[22]=l=>e.value.ruleForm.choiceDoc=l)},{default:r(()=>[a(V,{label:"品質手冊"}),a(V,{label:"程序"}),a(V,{label:"作業標準書"}),a(V,{label:"表格"}),a(V,{label:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1})])):S("",!0)]),_:1},8,["model","rules"])]),a(y(x)),De])])}}});export{Oe as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./LoadingGIF-EHAp8heU.js","./_plugin-vue_export-helper-x3n3nnut.js","./index-C8i1NBWL.js","./index-BaElX5cx.css","./CreateTopBtn-evltKm_Z.js","./電子表單icon_返回-ws5LyveC.js","./userStore-u9qmRA6a.js","./CreateTopBtn-mz3mEgq9.css","./FileCom-k_RcCnuG.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}